services:
  postgres:
    image: pgvector/pgvector:pg16
    container_name: pixav-postgres
    environment:
      POSTGRES_USER: pixav
      POSTGRES_PASSWORD: pixav
      POSTGRES_DB: pixav
    ports:
      - "${PIXAV_POSTGRES_PORT:-5432}:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
    networks:
      - pixav
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U pixav"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: pixav-redis
    ports:
      - "${PIXAV_REDIS_PORT:-6379}:6379"
    volumes:
      - redis-data:/data
    networks:
      - pixav
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: pixav-qbittorrent
    environment:
      PUID: 1000
      PGID: 1000
      TZ: UTC
      WEBUI_PORT: 8080
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    volumes:
      - qbit-config:/config
      - ./data/downloads:/downloads
    networks:
      - pixav

  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: pixav-jackett
    environment:
      PUID: 1000
      PGID: 1000
      TZ: UTC
    ports:
      - "9117:9117"
    volumes:
      - jackett-config:/config
    networks:
      - pixav

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: pixav-flaresolverr
    ports:
      - "8191:8191"
    environment:
      LOG_LEVEL: info
      CAPTCHA_SOLVER: nodejs
    networks:
      - pixav

  stash:
    image: stashapp/stash:latest
    container_name: pixav-stash
    ports:
      - "9999:9999"
    environment:
      STASH_PORT: 9999
    volumes:
      - stash-config:/root/.stash
      - ./data/stash:/data
    networks:
      - pixav

volumes:
  pgdata:
  redis-data:
  qbit-config:
  jackett-config:
  stash-config:

networks:
  pixav:
    driver: bridge
